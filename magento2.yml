image: docker:stable-git

variables:
  SLACK_WEBHOOK: _

before_script:
  - apk add --no-cache curl
  - mkdir ~/.ssh
  - echo $SSH_KEY | base64 -d > ~/.ssh/id_rsa
  - chmod -R 700 ~/.ssh
  - |-
    curl -X POST -H 'Content-type: application/json' --data "{'text': 'Deploying on $CI_COMMIT_REF_NAME-server!'}" $SLACK_WEBHOOK
    
.deploy-developer: &deploy-developer
  script: |-
          ssh -o StrictHostKeyChecking=no $login@$ssh_host "
            cd $path
            ls"
                                                      
.deploy-production: &deploy-production
  script: |-
          ssh -o StrictHostKeyChecking=no $login@$ssh_host "
            cd $path
            ls"

deploy_on_dev:
  <<: *deploy-developer
  variables:
    login: _
    path: _
    ssh_host: _
  only:
    - dev
    
deploy_on_stage:
  <<: *deploy-production
  variables:
    login: _
    path: _
    ssh_host: _
  only:
    - stage
    
deploy_on_master:
  <<: *deploy-production
  variables:
    login: _
    path: _
    ssh_host: _
  only:
    - master
